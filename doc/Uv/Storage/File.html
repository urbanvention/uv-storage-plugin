<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Uv::Storage::File</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (F)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Uv.html" title="Uv (module)">Uv</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Storage.html" title="Uv::Storage (module)">Storage</a></span></span>
     &raquo; 
    <span class="title">File</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Uv::Storage::File
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Uv::Storage::File</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/uv_storage/storage_file.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="ACL_PUBLIC-constant" class="">ACL_PUBLIC =
          <div class="docstring">
  <div class="discussion">
    <p>
access levels, see <tt>access_level</tt> for more details
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='string val'>'public'</span>
</pre></dd>
      
        <dt id="ACL_PROTECTED-constant" class="">ACL_PROTECTED =
          
        </dt>
        <dd><pre class="code"><span class='string val'>'protected'</span>
</pre></dd>
      
        <dt id="ACL_PRIVATE-constant" class="">ACL_PRIVATE =
          
        </dt>
        <dd><pre class="code"><span class='string val'>'private'</span>
</pre></dd>
      
        <dt id="ACL_EXPIRING-constant" class="">ACL_EXPIRING =
          
        </dt>
        <dd><pre class="code"><span class='string val'>'expiring'</span>
</pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#access_level-instance_method" title="#access_level (instance method)">- (String) <strong>access_level</strong>(force = false) </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the access level of the given file object in the cloud.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#client-instance_method" title="#client (instance method)">- (Object) <strong>client</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
HTTPClient instance.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#config-instance_method" title="#config (instance method)">- (Object) <strong>config</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Current config.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#connection-instance_method" title="#connection (instance method)">- (Object) <strong>connection</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
UV Storage Conncetion instance.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#logger-instance_method" title="#logger (instance method)">- (Object) <strong>logger</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
rails logger.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#meta-instance_method" title="#meta (instance method)">- (Object) <strong>meta</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Meta information.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#object-instance_method" title="#object (instance method)">- (Object) <strong>object</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Object this file belongs to.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- (Object) <strong>options</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Options given when initialized.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw_file-instance_method" title="#raw_file (instance method)">- (Object) <strong>raw_file</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
RAW File object for saving.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exists%3F-class_method" title="exists? (class method)">+ (Boolean) <strong>exists?</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check wether an object exists in the <tt>Uv::Storage</tt> cloud or not.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Close is an alias for <tt>save</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#content_type-instance_method" title="#content_type (instance method)">- (String) <strong>content_type</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Return the <tt>content_type</tt> of the file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#copy-instance_method" title="#copy (instance method)">- (Boolean) <strong>copy</strong>(to_object) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Copy a file to a new <tt>ActiveRecord::Base</tt> object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete a file from the <tt>Uv::Storage</tt> cloud.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filename-instance_method" title="#filename (instance method)">- (String) <strong>filename</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retrieve the cloud filename, which will return something like
1223434342.jpg.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (File) <strong>initialize</strong>(*args) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initializes a new <tt>Uv::Storage</tt> object either for retrieving a file or for
creating a new file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nodes-instance_method" title="#nodes (instance method)">- (Array) <strong>nodes</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the nodes where this file resides.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#path-instance_method" title="#path (instance method)">- (String) <strong>path</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the path of the file on the nodes.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-instance_method" title="#read (instance method)">- (String) <strong>read</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Read the contents of the file and return the raw data.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save-instance_method" title="#save (instance method)">- (Boolean) <strong>save</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Saves the current file in the cloud by sending it to the <tt>Uv::Storage</tt>
master.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-instance_method" title="#size (instance method)">- (Integer) <strong>size</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Return the <tt>size</tt> of the file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#url-instance_method" title="#url (instance method)">- (String) <strong>url</strong>(expires = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retrieve the url for the file in the <tt>Uv::Storage</tt> cloud.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Uv::Storage::File (class)">File</a></span></tt>) <strong>initialize</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Initializes a new <tt>Uv::Storage</tt> object either for retrieving a file or for
creating a new file.
</p>
<h2>Examples</h2>
<pre class="code">
  <span class='comment val'># Create a new file by passing in a +File+ Object</span>
  <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;/path/to/file&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>

  <span class='comment val'># Retrieve an existing file</span>
  <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
</pre>
<p>
The first argument, the <tt>File</tt> object is optional. You only need to
supply a <tt>File</tt> if you want to store a new file into the cloud. The
second argument is a options <tt>Hash</tt>. <b>The <tt>:object</tt> key is
required both for retrieving and storing files, at the moment. It is used
to identify the <tt>File</tt> and map the necessary file id.</b>
</p>
<p>
The <tt>File</tt> object needs to be either a Ruby <tt>File</tt> object or
a <tt>Tempfile</tt> object.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="ActiveRecordObjectMissing.html" title="Uv::Storage::ActiveRecordObjectMissing (class)">ActiveRecordObjectMissing</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 62</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span>     <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{RAILS_ROOT}/log/#{RAILS_ENV}.log&quot;</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='options identifier id'>options</span>    <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:access_level</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'public-read'</span><span class='comma token'>,</span>
    <span class='symbol val'>:file_mapping</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span>
    <span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span>
  <span class='rbrace token'>}</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='stringify_keys! fid id'>stringify_keys!</span>
  
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='raw_file identifier id'>raw_file</span>   <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='if if_mod kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Tempfile constant id'>Tempfile</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='config identifier id'>config</span>     <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='client identifier id'>client</span>     <span class='assign token'>=</span> <span class='HTTPClient constant id'>HTTPClient</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='Connection constant id'>Connection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span>     <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='string val'>'object'</span><span class='rbrack token'>]</span>
  
  <span class='raise identifier id'>raise</span> <span class='ActiveRecordObjectMissing constant id'>ActiveRecordObjectMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='validate_object identifier id'>validate_object</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='rparen token'>)</span>
  
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Initializing new Uv::Storage::File&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Config loaded:        #{config.inspect}&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Connection loaded:    #{connection.inspect}&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Object given:         #{object.inspect}&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Raw File given:       #{raw_file.inspect}&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Options given:        #{options.inspect}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="access_level=-instance_method"></span>
      <span id="access_level-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="access_level-instance_method">
  
    - (<tt>String</tt>) <strong>access_level</strong>(force = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the access level of the given file object in the cloud. This can be
one of the following (String):
</p>
<ul>
<li>Uv::Storage::File::ACL_PUBLIC - <b>default</b> File is publicly readable
without any verification or authentication (fastest in read perfomance)

</li>
<li>Uv::Storage::File::ACL_PROTECTED - Only allow to read the file with an
signature, which expires every 5 minutes

</li>
<li>Uv::Storage::File::ACL_PRIVATE - Do not make the file publicly available,
can only be accessed by the server it self

</li>
<li>Uv::Storage::File::ACL_EXPIRING - Special file that expires after a certain
time (then turns private)

</li>
</ul>
<p>
Use the constants if you want check a certain access level of a file.
</p>
<p>
The access_level of the file is kept locally in the database. If this value
does not exist or <tt>force</tt> is given, the access_level will be pulled
remotely from the storage node.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='uv_file identifier id'>uv_file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='uv_file identifier id'>uv_file</span><span class='dot token'>.</span><span class='access_level identifier id'>access_level</span> <span class='eq op'>==</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='ACL_PUBLIC constant id'>ACL_PUBLIC</span>
    <span class='comment val'># file is public</span>
  <span class='end end kw'>end</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>force</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Force an update from the server
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
the access level of the file or false if non exists
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 34</span>

<span class='def def kw'>def</span> <span class='access_level identifier id'>access_level</span><span class='lparen token'>(</span><span class='force identifier id'>force</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='force identifier id'>force</span> <span class='and and kw'>and</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='and and kw'>and</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='access_level identifier id'>access_level</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='access_level identifier id'>access_level</span>
  <span class='else else kw'>else</span>
    <span class='retrieve_meta! fid id'>retrieve_meta!</span>
    
    <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='meta identifier id'>meta</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='false false kw'>false</span> <span class='colon op'>:</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='meta identifier id'>meta</span><span class='lbrack token'>[</span><span class='string val'>'access_level'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="client=-instance_method"></span>
      <span id="client-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="client-instance_method">
  
    - (<tt>Object</tt>) <strong>client</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
HTTPClient instance
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 25</span>

<span class='def def kw'>def</span> <span class='client identifier id'>client</span>
  <span class='@client ivar id'>@client</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="config=-instance_method"></span>
      <span id="config-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="config-instance_method">
  
    - (<tt>Object</tt>) <strong>config</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Current config
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 19</span>

<span class='def def kw'>def</span> <span class='config identifier id'>config</span>
  <span class='@config ivar id'>@config</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="connection=-instance_method"></span>
      <span id="connection-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="connection-instance_method">
  
    - (<tt>Object</tt>) <strong>connection</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
UV Storage Conncetion instance
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 28</span>

<span class='def def kw'>def</span> <span class='connection identifier id'>connection</span>
  <span class='@connection ivar id'>@connection</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="logger-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="logger-instance_method">
  
    - (<tt>Object</tt>) <strong>logger</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
rails logger
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 37</span>

<span class='def def kw'>def</span> <span class='logger identifier id'>logger</span>
  <span class='@logger ivar id'>@logger</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="meta=-instance_method"></span>
      <span id="meta-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="meta-instance_method">
  
    - (<tt>Object</tt>) <strong>meta</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Meta information
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 22</span>

<span class='def def kw'>def</span> <span class='meta identifier id'>meta</span>
  <span class='@meta ivar id'>@meta</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="object=-instance_method"></span>
      <span id="object-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="object-instance_method">
  
    - (<tt>Object</tt>) <strong>object</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Object this file belongs to
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 31</span>

<span class='def def kw'>def</span> <span class='object identifier id'>object</span>
  <span class='@object ivar id'>@object</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="options=-instance_method"></span>
      <span id="options-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="options-instance_method">
  
    - (<tt>Object</tt>) <strong>options</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Options given when initialized
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 16</span>

<span class='def def kw'>def</span> <span class='options identifier id'>options</span>
  <span class='@options ivar id'>@options</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="raw_file=-instance_method"></span>
      <span id="raw_file-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="raw_file-instance_method">
  
    - (<tt>Object</tt>) <strong>raw_file</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
RAW File object for saving
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 13</span>

<span class='def def kw'>def</span> <span class='raw_file identifier id'>raw_file</span>
  <span class='@raw_file ivar id'>@raw_file</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="exists?-class_method">
  
    + (<tt>Boolean</tt>) <strong>exists?</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Check wether an object exists in the <tt>Uv::Storage</tt> cloud or not.
</p>
<p>
Either an id or an object has to be given.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>id</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Optional: the id of the <tt>Uv::Storage::FileMapping</tt> to look for.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>ActiveRecord::Base</tt>)</span>
      
      
        <span class='name'>object</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Optional: the object the file should be associated to.
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
true if the file exists, false if it does not.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 100</span>

<span class='def def kw'>def</span> <span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='begin begin kw'>begin</span>
    <span class='if if kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Integer constant id'>Integer</span><span class='rparen token'>)</span>
      <span class='comment val'># find the mapping</span>
      <span class='mapping identifier id'>mapping</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='FileMapping constant id'>FileMapping</span><span class='dot token'>.</span><span class='find_by_id identifier id'>find_by_id</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>

      <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='unless unless_mod kw'>unless</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='present? fid id'>present?</span>
    <span class='elsif elsif kw'>elsif</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='rparen token'>)</span>
      <span class='mapping identifier id'>mapping</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='FileMapping constant id'>FileMapping</span><span class='dot token'>.</span><span class='find_by_object_name_and_object_identifier identifier id'>find_by_object_name_and_object_identifier</span><span class='lparen token'>(</span>
        <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span><span class='comma token'>,</span> 
        <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
      <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    
    <span class='@file ivar id'>@file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='StorageFile constant id'>StorageFile</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:file_mapping</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='mapping identifier id'>mapping</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='@file ivar id'>@file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='integer val'>? </span><span class='true true kw'>true</span> <span class='colon op'>:</span> <span class='false false kw'>false</span>
  <span class='rescue rescue kw'>rescue</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="close-instance_method">
  
    - (<tt>Object</tt>) <strong>close</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Close is an alias for <tt>save</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


396
397
398</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 396</span>

<span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='save identifier id'>save</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="content_type-instance_method">
  
    - (<tt>String</tt>) <strong>content_type</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Return the <tt>content_type</tt> of the file.
</p>
<p>
This will call the server, retrieve the necessary meta information and will
return you the correct content_type for the file. This method calls the
server, so the content_type should be cached.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='content_type identifier id'>content_type</span>
</pre>
<p>
goes wrong
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
String with the content_type e.g. application/octet-stream, false or
exception if someting
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


337
338
339
340
341
342
343
344</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 337</span>

<span class='def def kw'>def</span> <span class='content_type identifier id'>content_type</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='raise identifier id'>raise</span> <span class='NodesMissing constant id'>NodesMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='retrieve_meta! fid id'>retrieve_meta!</span>
  
  <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='meta identifier id'>meta</span><span class='lbrack token'>[</span><span class='string val'>'content_type'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="copy-instance_method">
  
    - (<tt>Boolean</tt>) <strong>copy</strong>(to_object) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Copy a file to a new <tt>ActiveRecord::Base</tt> object.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>ActiveRecord::Base</tt>)</span>
      
      
        <span class='name'>object</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object to copy the file to
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 129</span>

<span class='def def kw'>def</span> <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='to_object identifier id'>to_object</span><span class='rparen token'>)</span>
  <span class='validate_object identifier id'>validate_object</span><span class='lparen token'>(</span><span class='to_object identifier id'>to_object</span><span class='rparen token'>)</span>
  
  <span class='begin begin kw'>begin</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Initialized Uv::Storage::File#copy&quot;</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Trying to download the file, and write it to a tempfile&quot;</span>
    
    <span class='tmp_file_name identifier id'>tmp_file_name</span>   <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='RAILS_ROOT constant id'>RAILS_ROOT</span><span class='comma token'>,</span> <span class='string val'>'tmp'</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
    <span class='tmp_file identifier id'>tmp_file</span>        <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='tmp_file_name identifier id'>tmp_file_name</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> 
    <span class='tmp_file identifier id'>tmp_file</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rparen token'>)</span>
    
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Tempfile written to: #{tmp_file_name}&quot;</span>         
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Creating a new file to copy to.&quot;</span>

    <span class='new_file identifier id'>new_file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='tmp_file identifier id'>tmp_file</span><span class='comma token'>,</span> <span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_object identifier id'>to_object</span><span class='rparen token'>)</span>
    <span class='new_file identifier id'>new_file</span><span class='dot token'>.</span><span class='save identifier id'>save</span>

    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='fatal identifier id'>fatal</span> <span class='string val'>&quot;An error occured in Uv::Storage::File#copy&quot;</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='fatal identifier id'>fatal</span> <span class='dstring node'>&quot;Error was: #{e}&quot;</span>
    
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Delete a file from the <tt>Uv::Storage</tt> cloud.
</p>
<p>
This will delete a file from the cloud and raise if an exception if
something is wrong.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='on identifier id'>on</span> <span class='success identifier id'>success</span> <span class='or or kw'>or</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='failed identifier id'>failed</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 307</span>

<span class='def def kw'>def</span> <span class='destroy identifier id'>destroy</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='raise identifier id'>raise</span> <span class='NodesMissing constant id'>NodesMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='begin begin kw'>begin</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='mapping identifier id'>mapping</span><span class='rparen token'>)</span>

    <span class='return return kw'>return</span> <span class='true true kw'>true</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='fatal identifier id'>fatal</span> <span class='string val'>&quot;There was an error deleting the file.&quot;</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='fatal identifier id'>fatal</span> <span class='dstring node'>&quot;#{e}&quot;</span>
    
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="filename-instance_method">
  
    - (<tt>String</tt>) <strong>filename</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Retrieve the cloud filename, which will return something like
1223434342.jpg
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span> <span class='comment val'># =&gt; returns the file name if a object exists, raises exception if an error occurs</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
Returns the filename of the cloud file
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 256</span>

<span class='def def kw'>def</span> <span class='filename identifier id'>filename</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='return return kw'>return</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='integer val'>? </span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='basename identifier id'>basename</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;/&quot;</span><span class='comma token'>,</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="nodes-instance_method">
  
    - (<tt>Array</tt>) <strong>nodes</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the nodes where this file resides.
</p>
<p>
Each file will be stored on at least one node, the replication level of
each file (the number of nodes to which, will be replicated to) can be set
on the master-server by an administrator. If a node goes down, it will be
removed from the database, so this value may change.
</p>
<p>
Reads the nodes array from the <tt>FileMapping</tt> table. The array
contains string with subdomains, those can be computed to a full url with
Uv::Storage.asset_domain. This method should only be used internaly.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='nodes identifier id'>nodes</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span>

  <span class='comment val'># compute url</span>
  <span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;http://#{nodes.first.to_s}.#{Uv::Storage.asset_domain}/&quot;</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
Array of nodes. Contains strings with node subdomains
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


457
458
459
460
461</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 457</span>

<span class='def def kw'>def</span> <span class='nodes identifier id'>nodes</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='return return kw'>return</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="path-instance_method">
  
    - (<tt>String</tt>) <strong>path</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the path of the file on the nodes.
</p>
<p>
Each file will be stored on multiple nodes, but they will always have the
same path on all nodes. This path to the file will be saved in the
<tt>Uv::Storage::FileMapping</tt> so there is no need for an extra request to
retrieve the url.
</p>
<p>
This should only be used internaly, because it ignores the access level of
the file.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span>  <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='nodes identifier id'>nodes</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span>
  <span class='path identifier id'>path</span>  <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='path identifier id'>path</span>

  <span class='comment val'># compute url</span>
  <span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;http://#{nodes.first.to_s}.#{Uv::Storage.asset_domain}/#{path}&quot;</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
The global path to the file on all nodes where it is stored.
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


483
484
485
486
487</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 483</span>

<span class='def def kw'>def</span> <span class='path identifier id'>path</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='return return kw'>return</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='file_path identifier id'>file_path</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="read-instance_method">
  
    - (<tt>String</tt>) <strong>read</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Read the contents of the file and return the raw data.
</p>
<p>
This will call the server with the <tt>url</tt> method and read the
contents of the file. This emulates the ruby <tt>File#read</tt> method. This
method calls the server so the result should be cached.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;new/file/path&quot;</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='comment val'># =&gt; Will read the file and write it to a local one</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='end end kw'>end</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
Returns the raw data as a <tt>String</tt>
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


384
385
386
387
388
389
390
391</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 384</span>

<span class='def def kw'>def</span> <span class='read identifier id'>read</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='raise identifier id'>raise</span> <span class='NodesMissing constant id'>NodesMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='@content ivar id'>@content</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='get_file_content identifier id'>get_file_content</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='rparen token'>)</span>
  
  <span class='return return kw'>return</span> <span class='@content ivar id'>@content</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="save-instance_method">
  
    - (<tt>Boolean</tt>) <strong>save</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Saves the current file in the cloud by sending it to the <tt>Uv::Storage</tt>
master.
</p>
<p>
After the file has been created in the <tt>Uv::Storage</tt> cloud, the resulting
information will be saved in the <tt>Uv::Storage::FileMapping</tt> table, together
with the associated object.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'path/to/file), :object =&gt; Photo.all.first)
  file.save # =&gt; saves the file to the cloud
</span></pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
True if succeeded or false if the request failed.
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="ActiveRecordObjectInvalid.html" title="Uv::Storage::ActiveRecordObjectInvalid (class)">ActiveRecordObjectInvalid</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 413</span>

<span class='def def kw'>def</span> <span class='save identifier id'>save</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='present? fid id'>present?</span> <span class='comment val'># already saved that file</span>
  <span class='validate_object identifier id'>validate_object</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='rparen token'>)</span>
  
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Sending file to master in Uv::Storage::File#save&quot;</span>
  
  <span class='@result ivar id'>@result</span> <span class='assign token'>=</span> <span class='send_file_to_master! fid id'>send_file_to_master!</span>
            
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='FileMapping constant id'>FileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> 
    <span class='symbol val'>:nodes</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@result ivar id'>@result</span><span class='lbrack token'>[</span><span class='string val'>'node_domains'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
    <span class='symbol val'>:file_path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@result ivar id'>@result</span><span class='lbrack token'>[</span><span class='string val'>'path'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
    <span class='symbol val'>:access_level</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@result ivar id'>@result</span><span class='lbrack token'>[</span><span class='string val'>'access_level'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:object_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span><span class='comma token'>,</span>
    <span class='symbol val'>:object_identifier</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object identifier id'>object</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
  <span class='rparen token'>)</span>
    
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Trying to save mapping in Uv::Storage::File#save&quot;</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
  
  <span class='raise identifier id'>raise</span> <span class='ActiveRecordObjectInvalid constant id'>ActiveRecordObjectInvalid</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='valid? fid id'>valid?</span>
  
  <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="size-instance_method">
  
    - (<tt>Integer</tt>) <strong>size</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Return the <tt>size</tt> of the file.
</p>
<p>
This will call the server, retrieve the necessary meta information and will
return you the correct size in bytes for the file. This method calls the
server, so the size should be cached.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='comment val'># =&gt; Returns the size in bytes</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
Returns the size in bytes, raises exception or returns false if something
goes wrong
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


359
360
361
362
363
364
365
366</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 359</span>

<span class='def def kw'>def</span> <span class='size identifier id'>size</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='raise identifier id'>raise</span> <span class='NodesMissing constant id'>NodesMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='retrieve_meta! fid id'>retrieve_meta!</span>
  
  <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='meta identifier id'>meta</span><span class='lbrack token'>[</span><span class='string val'>'size'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="url-instance_method">
  
    - (<tt>String</tt>) <strong>url</strong>(expires = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Retrieve the url for the file in the <tt>Uv::Storage</tt> cloud.
</p>
<p>
TODO: Implement expires logic This will return an url to a storage node
with the file on it. Depending on the access level either a public url will
be generated or a signed url is going to be created.
</p>
<p>
If you pass in a expires time in seconds, you will get an expiring url.
This url will invalidate after the time you provided.
</p>
<h2>Example</h2>
<pre class="code">
  <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='Uv constant id'>Uv</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='colon2 op'>::</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='url identifier id'>url</span> <span class='comment val'># =&gt; Returns a string with the url</span>
</pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>expires</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Time in seconds when the url should expire
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        <div class='inline'><p>
Returns a url string, or raises an exception if something is missing
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="MissingFileMapping.html" title="Uv::Storage::MissingFileMapping (class)">MissingFileMapping</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/uv_storage/storage_file.rb', line 280</span>

<span class='def def kw'>def</span> <span class='url identifier id'>url</span><span class='lparen token'>(</span><span class='expires identifier id'>expires</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MissingFileMapping constant id'>MissingFileMapping</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='raise identifier id'>raise</span> <span class='NodesMissing constant id'>NodesMissing</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='mapping identifier id'>mapping</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;URLs are beeing generated.&quot;</span>
  
  <span class='@urls ivar id'>@urls</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='nodes identifier id'>nodes</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='node identifier id'>node</span><span class='bitor op'>|</span>
    <span class='@urls ivar id'>@urls</span> <span class='lshft op'>&lt;&lt;</span> <span class='file_url identifier id'>file_url</span><span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='@urls ivar id'>@urls</span><span class='dot token'>.</span><span class='shuffle! fid id'>shuffle!</span>
  <span class='@url ivar id'>@url</span> <span class='assign token'>=</span> <span class='@urls ivar id'>@urls</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  
  <span class='return return kw'>return</span> <span class='@url ivar id'>@url</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Sep 22 17:06:23 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.8.7).
</div>

  </body>
</html>